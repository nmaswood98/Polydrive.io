var Manager={d:new Date(),init:function(serverIP,application,name,menu){this.app=application;var primus=null;var socket={};this.travelTime=0;this.currentTime=this.d.getTime();this.lastTime=0;this.serverUpdates=[];this.lastServerUpdate=null;var game=Object.create(Game);game.init(primus,application,name,menu.cCarIndex);game.app.ticker.add((delta)=>{game.ticker(delta)});game.isDrawing=!1;game.hide();window.addEventListener('resize',()=>{this.app.renderer.resize(window.innerWidth*2,window.innerHeight*2);this.app.renderer.view.style.width=this.app.screen.width/2+"px";this.app.renderer.view.style.height=this.app.screen.height/2+"px";menu.updateSize();game.updateSize(window.innerWidth*2,window.innerHeight*2)});this.drawFrame=game.draw.bind(game);this.hideGame=game.hide.bind(game);this.hideMenu=menu.hideMenu.bind(menu);this.showMenu=menu.showMenu.bind(menu);this.createSocket=(serverIP)=>{if(primus===null){primus=new Primus(serverIP);initializeSocket(primus)}
else{primus.destroy();primus=new Primus(serverIP);initializeSocket(primus)}};var initializeSocket=(p)=>{game.setSocket(p);p.on('data',(data)=>{switch(data[0]){case 0:let d=new Date();let timeStamp=data.pop();let currentTime=d.getTime()-this.travelTime;this.travelTime=Date.now()-timeStamp;let serverUpdate=[timeStamp,data];this.serverUpdates.push(serverUpdate);if(this.serverUpdates.length==2){this.drawGame(this.serverUpdates)}
break;case 1:game.car.x=data[1];game.car.y=data[2];game.car.id="Player";game.resizeGame(data[3]);menu.hideMenu();game.show();game.car.swapTexture(menu.cCarIndex);break;case 2:game.starting=!1;var blurFilter2=new PIXI.filters.BlurFilter();blurFilter2.resolution=0.5;blurFilter2.blur=0;this.app.stage.filters=[blurFilter2];setTimeout(()=>{TweenMax.to(blurFilter2,1.5,{ease:Linear.easeNone,blur:10})},1500);setTimeout(()=>{this.hideGame();this.showMenu();this.app.stage.filters=[]},3000);game.car.visible=!1;break;case 3:game.lBoard.updateLeaderboard(data);break;case 5:this.app.notify("Servers Full.");break;default:console.log("ERROR: Unrecognized packet from the server",data)}});p.on('incoming::ping',(data)=>{console.log("Ping")})};this.spawn=(name,carIndex)=>{game.starting=!0;if(primus!=null)
primus.write(["spawn",name,carIndex]);else{this.app.notify("Servers Full.");fetch("/GameServer/east").then((response)=>{return response.text()}).then((serverIP)=>{if(serverIP!='0')
this.createSocket(serverIP)})}};window.addCars=(amount)=>{var sc=0.009467213*amount+1.090164;if(amount<15)
sc=1;else if(amount>=200)
sc=0.005*amount+2;for(var i=0;i<amount;i++)
socket.emit("newC");};this.intialized=!0},drawGame:function(snapShotArray){var offset=200;this.drawFrame(snapShotArray[0][1],offset);snapShotArray.splice(0,1)},ticker:function(delta){}}
